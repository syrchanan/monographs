{
  "hash": "7dc88269b0de3660cd831f151c05829b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"2024 Day 6: Guard Gallivant\"\nsubtitle: \"Advent of Code\"\ndate: \"2024-12-06\"\nformat: \n  html: \n    code-line-numbers: false\n# image: \"./ElmerEllsworthphoto01.jpg\"\ncategories:\n  - Advent of Code\n  - OJS\ndraft: false\n---\n\n\n\n[Day 6](https://adventofcode.com/2024/day/6)!\n\n\n\n::: {.cell tags='parameters'}\n\n:::\n\n::: {.cell}\n\n:::\n\n\n\n### Part 1\n\nToday, it feels like we are designing a videogame! I usually hide the input parsing, though I thought today's was notable in that I found a better way to map out a grid using integer and mod division to calculate the starting position:  \n\n\n\n```{ojs}\n\ninput = {\n  const map = raw.split('\\n').map(d => d.split(\"\")) // 2D array\n  const [nrow, ncol] = [map.length, map[0].length] // dims\n  const start_index = map.flat().indexOf(\"^\") // guard start\n  // use integer & mod div to find location\n  const [curr_row, curr_col] = [Math.floor(start_index/ncol), start_index % ncol]\n  const clean_map = map.slice()\n  clean_map[curr_row][curr_col] = '.' // replace so it's counted as an empty spot\n\n  const input = {\n    start: [curr_row, curr_col],\n    layout: clean_map,\n    dir: 0, // up\n    dims: [nrow, ncol]\n  }\n  \n  return input\n}\n\n```\n\n\n\nNow that that is sorted, let's proceed to part 1...\n\n\n\n```{ojs}\n\npossible_moves = [\n  [-1, 0], // up\n  [0, 1], // right\n  [1, 0], // down\n  [0, -1] // left\n]\n\n```\n\n\n\nFirst, since we know we are navigating around a grid, let's define movements in the four cardinal directions.\n\n\n\n```{ojs}\n\nmove_guard = (input, possible_moves) => {\n  const pos = [] // positions\n  let [[row, col], dir] = [input.start, input.dir]\n\n  while (true) { // until guard leaves grid\n    \n    // add current position and heading\n    pos.push([row, col, dir])\n\n    // get next pos and direction\n    const [next_row, next_col] = [row + possible_moves[dir][0], \n                                  col + possible_moves[dir][1]]\n    \n    // OOB check\n    if (next_row < 0 || next_row >= input.dims[0] || \n          next_col < 0 || next_col >= input.dims[1]) {\n      return pos\n    } \n\n    // if blocked, turn right\n    if (input.layout[next_row][next_col] === \"#\") {\n      dir = (dir + 1) % 4\n    }\n\n    // update position so it gets pushed for next iter\n    [row, col] = [row + possible_moves[dir][0], \n                  col + possible_moves[dir][1]]\n    \n  }\n}\n\n```\n\n\n\nNow we're getting serious -- the main bulk of the problem!  \n\nThis function traces the guard's path by running through each step in a while loop. This way, we can set the condition to break on the guard leaving the bounds of our grid. Also, since we are keeping track of the direction using an integer, we can utilize it as an index with a little creative math.  \n\nThough this function looks clean, it was not my first attempt. I originally thought that this would be a great use case for a recursive function -- each call would move the guard a step forward, then call itself again (assuming it stayed in bounds). However, as soon as I scaled up to the full input, I exceeded the call stack, so I went back to the drawing board.\n\n\n\n```{ojs}\n\nnew Set(move_guard(input, possible_moves)\n      .map(d => JSON.stringify( [ d[0], d[1] ] ))).size\n\n```\n\n\n\nOnce we have our function, it's just a matter of finding the number of unique positions visited. I chose to do this with `JSON.stringify()`, then creating a Set from those strings and counting the length. After the fact, I saw someone's solution for another day that used bitwise shifts and joins to calculate uniques (which I'll use in Part 2).\n\nPart 1 complete!\n\n⭐\n\n### Part 2\n\nUh oh, more complex now... we have to check how many discrete locations we can add an extra obstacle to in the guard's path to send him into an infinite loop. This was daunting to start with, because anything that has to deal with checking for infinite loops seems difficult to do without launching into an infinite loop yourself. For example, if you revisit a specific location, who's to say that your next step will continue the loop?\n\nHowever, after some pondering, I realized that that is **not** the case here. We have very specific rules about movement, so we can say with certainty that if a position is repeated, and a guard is facing the same way as before, then a loop is happening. In fact, we can abstract it away farther, and only care about checking the turn points for overlaps, since those are the 'decision points' where a loop could be entered.\n\n\n\n```{ojs}\n\ncheck_loop = (input, possible_moves) => {\n  const pos = new Set()\n  let [[row, col], dir] = [input.start, input.dir]\n  let turn = false\n\n  while(true) {\n    // if move is a turn\n    if (turn) {\n      // check if position and heading exists\n      const current_pos = (row << 16) | (col << 8) | dir\n      if (pos.has(current_pos)) {\n        // exit and say yes loop exists\n        return true\n      }\n      // otherwise add and keep going\n      pos.add(current_pos)\n    }\n\n    // get next pos and direction\n    const [next_row, next_col] = [row + possible_moves[dir][0], \n                                  col + possible_moves[dir][1]]\n\n    // OOB check\n    if (next_row < 0 || next_row >= input.dims[0] || \n          next_col < 0 || next_col >= input.dims[1]) {\n      return false // no loop, exits grid\n    }\n\n    if (input.layout[next_row][next_col] === \"#\") {\n      dir = (dir + 1) % 4\n      turn = true\n    } else {\n      row = next_row\n      col = next_col\n      turn = false\n    }\n  }\n}\n\n```\n\n\n\nTo start, let's modify the previous function to log all the positions as a Set, as well as tracking the heading in the position Set, as that will be critical to determining if we are in a loop.\n\nAnother change of note is we are now keeping a boolean flag `turn` to keep track of whether each move is a turn or not. This way, we can say that if the guard is turning, check if the position has been reached before; otherwise, continue as is onto the next step.\n\nIf you look closely, you'll also see the bit shifting mentioned above being used to collapse row, col, and dir down to one number.\n\n\n\n```{ojs}\n\n{\n  // get unique route positions\n  const all_route = move_guard(input, possible_moves)\n    .map(d => (d[0] << 8) | d[1] )\n  \n  const unique_pos = Array.from(new Set(all_route))\n    // multiply by masking hex codes to shorten down the bits \n    .map(d => ( [(d >> 8) & 0xFF, d & 0xFF] ))\n  \n  // keep track of new obstacles\n  const loop_counter = new Set()\n\n  // for each position on the route\n  unique_pos.forEach(d => {\n    // add obstacle\n    input.layout[ d[0] ][ d[1] ] = \"#\"\n    // see if loop exists\n    if (check_loop(input, possible_moves)) {\n      // add to tracker\n      loop_counter.add( (d[0] << 8) | d[1] )\n    }\n    // reset layout for next iter\n    input.layout[ d[0] ][ d[1] ] = \".\"\n  })\n  // return unique counts\n  return loop_counter.size - 1 // duped the start position\n}\n\n```\n\n\n\nUnfortunately, there wasn't many better ways to find all the loops than to try each one, adding an obstacle to a different location each time. To shrink the search space some, I decided to only try adding obstacles to the locations that the guard visited in Part 1 -- after all, if he never runs into it, then it won't be a loop since we know that he exits cleanly with the default map.\n\nAnyways, we just need to iterate through those positions, modifying the grid and running our `check_loop()` function on each; once we have the resultant positions, we just need the count of uniques.\n\n⭐\n\n------------------------------------------------------------------------\n\nRamping up in difficulty for sure now!\n\n-CH\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script type=\"ojs-define\">\n{\"contents\":[{\"name\":\"raw\",\"value\":\".........#...#................................#.........#............#.....#....#.....................................#...........\\n............................................................................................#...............#.......#.............\\n....#.......#......................................#.........................#..#....#....#.........#.............................\\n............##..#............#........................#........#........#.......#...........................#................#....\\n..................................#.............#....#..........................#................#..#....##........#..............\\n..................##.#...#....#...................##.....#.................#......##.....................##............#..........\\n..........#..................................#....................................................................................\\n......#...........#.......................................#........#........................#........#............................\\n..................#................................#........................#.............................#.......................\\n.............#............................................................................................##.................#....\\n........#..............................................................................................#..............#.#.......#.\\n..#...........#..............#..............#..#.....#.......#......#.......................#....#...................##..........#\\n..............##................................#..............##....................#...#........................................\\n......................#.................#.......#.......##.##....................................#................................\\n...........#...#.#..................#...#.....................................................................#...................\\n.....#....#...#..............................................................................................#.......#............\\n...............................#...........#.#.............#.........#.....................................#.#....................\\n........#...........#.......#............................#.....#.............................#.........................#..........\\n...................................................#...........#.....#..#....#.............#.....#..#..#.............#............\\n..............#.........#..#..........#.#.......................#...................................#.............................\\n..#.............#..#..#.#...........#...................................................#...........................#...........#.\\n........##....##..........................................................................#.......................................\\n.......................................................#.......#.............................#...................#........#.......\\n#.....#.#......#...............................................................#..........#........#..............................\\n.#.#............#..............#..........................#.#.....................................................#...............\\n.................#...#........#....#.....#...#...................................#....#.................#..........#...#.#...#....\\n...#..##........................#..#..................................................................................#.......#...\\n.................#...#.#..................................................#..#........#.................#...................#.....\\n.......................#.......#....................#......................................#...............................#......\\n...............................................................................................................................#..\\n...........##............................#....................#...................................................................\\n..#........................................#..#.............................#............................#........................\\n..#.#....#..................................#...................................................................................#.\\n.................#...#...............#..........#..............................#...#..............................#.#..#..........\\n............#..........#..........#...................................#.....#....................#................##.............#\\n....#...........#.......#......................................#........................................#........#......#...#.....\\n.............#.....#...................#....#.....................................................................................\\n.....................#.................................#.#...................#.......#.#...............#..........................\\n........#..............#.......#.............#...........................................................#........#..............#\\n............#............................................#.......##................#..............................................\\n...............................#..................................................................................................\\n#....................#......#.......................#..........#.........................#................#...............#..#...#\\n..................................................#.....#...........#...#..#......#...........................#...................\\n............#......................#.....#.........#....................................................................#....#....\\n.......#...................#...#...........................#.......#......#......................................#.....#..........\\n.................................................#.............#....................................#.............................\\n......#.................#.............................................................................#..##.......................\\n....#..............................................#..............#..........#.......#....#............................#..........\\n........#....#............#....#.................#........................................................#.....#.................\\n..#......................#.......................................................#................................................\\n.#.....................#..........................................................#.............................#.................\\n.............#..............#.#.....#.........................................#...............................#.........#.........\\n.............................................................................#............................#....#...#..............\\n#.#.#...................................................................#...........................................#.........#...\\n..................................................#.#............#..#...#..............#.....#....................................\\n......#..................................#............................##.........................................#................\\n..#....................................#............#.........#.........#...........#.....#..............................#........\\n......................................#.............#..................#.................#..........................##............\\n...............#.#........#.......................#..........#...............................#.............................#.#....\\n.................#....................................................................................#...........................\\n#...............................................#.#........#...#...................#............#.................#......#.#......\\n................#........................#......#.............................................#.#..............#....#.............\\n.......#..........#..........................#......#.............................................................................\\n....#.......#.................................................#..............#...........#.....#............#............#........\\n.....................#...................................#...............................................................#........\\n#..........................#..#...........................................#...............#............#............#.............\\n.............................#...................................#...#.......................................#......#.............\\n............#........#.................................................#.................#...................#....................\\n.........................................#................#.....................................#.................................\\n...........................................................................................#.....................#................\\n.....................#.........#..#.#......................................................#........#.............................\\n..#......#.........#.#...................................................#......................#.................................\\n.#...........#.........................................................................................#.....................#....\\n..........#....##.#..#..........#........#.#.................................#.....................#..............................\\n.....#........#.......#....#...........#...................#...............#..#....#..............................#..............#\\n.......#..............................#............#.................................................#........#................#..\\n...............................#..............................................#...................................................\\n#..............................................................#.........................................................#........\\n.......#....................................................#..............................#..................#..........##.......\\n.......................................#...............................................^.............#............................\\n..#...........#.........#............................#...................................#.#.......###.....#......................\\n........#............................................................................................................#............\\n...#...#...........#.................................................................#...#.......#........#.......................\\n...............#.....................................#..........#.......#.#.....#.#..................#............................\\n.....#..#..............#.#.......................#.................................................................#..............\\n#.....#.........................................#..##....#..........................#...................#..#......#........#......\\n...................##................#..#......................................#.....#............................................\\n....#...............................................................................................#...........................#.\\n....#..........#....#........................#....................................................................................\\n..................#.....................................................#.....................................#...................\\n...........................#......#.......................................................................#..............#........\\n...............#....................#...#...#.......#................#.......#.......#............................................\\n#.....##......#.............................................#...#.................................#.................#....#..##..#.\\n..........#.......................................#..................................#...#....#......................#............\\n......#................#.#........#....#......##.........#........................................#...............................\\n......#...#............#...#.........................................................#....#.....#..............#..................\\n.........................#...............#........#...#......#....................................................#..#.#..........\\n...##............#........#.#.........................#.............................#............#..............#.................\\n.......#.........#..............................#...................................#.......................#.#...................\\n#..........#.............#..............................................#.....................................................#...\\n........#..#...#.....................................#............................................................................\\n..................#...............................#..........................................#.............#..............#..#....\\n....#.#..#...#............................#..............#...#..........#......#....#.....................#..........#......#.....\\n................#..............#........................#......#..............#.......................##..........................\\n..........#.....#.............................................#.......#...........................................#...............\\n.........#....#........#............#...............#.............................................................................\\n...........#..#..........#..............#..........#......#.......................................................................\\n..........#....................#........................................#.....#..................#..#.#..#...#.....#..............\\n........#...........#...#..................##.........#......................#...#............#......................#............\\n...................................................#........................#.....#.............#.................................\\n........#................#..........................#.#...#......#........................................#.......................\\n.............#.........................................##....................#...................#.#..................#...........\\n..................#.............................................#...............................................................#.\\n.....#............#................#..............................#...##....#...#.................................................\\n#.......................###........#..............#.....#.............#...............#.............#......................#......\\n...........#.............................#........................#.........................................................#.....\\n............#.....#.....#...#....#........#...............................#.....................#..................#....#.........\\n...............#.#..................................#.................#.#......#...........#...#................#.................\\n.....#............................................#.....#...............#.....#.............#.......#..........#..................\\n.....................................#................................................#.........#..#..............................\\n.....................#...............................................#.#...........#........#.....................................\\n.............................................#....................#.............#......................#..........................\\n......................................#.........#.........................##........#................#...............#............\\n........................#.....#.....................................#....#........#......#..............#.......##...........#.#..\\n....................#........................................#.........#.........#......#....#............#...........#...........\\n...........##......#...........#................#.......##.....#........#.........#...........................................#...\\n...................#...#....#.............#..#......................................................#............#................\\n....#.........................#....#..................#..............#.............#...................................#..........\\n..................................#.......#.....................#.................................................................\\n.............................................#......#.......................................................#.....................\"}]}\n</script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}